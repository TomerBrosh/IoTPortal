<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="graph-container" attributes="soldiers selectedStatus">
  <template>
    <style>
      :host {
        display: inline-flex;
        visibility: hidden;
        width: 100%;
        margin-top: 5px;
      }

      paper-material {
        width: 100%;
        background-color: rgba(96, 125, 139, 0.2);
        text-align: center;
      }

      .graphs {
        height:268px;
        @apply(--layout-horizontal);
        @apply(--layout-around-justified);
        @apply(--layout-scroling);
        overflow-y: hidden;
      }
      .nothing::after {
        content: 'אין';
      }

      .blank {
      }


    </style>
    <paper-material elevation="3">
        <h2>מצב החיילים</h2>

          <template is="dom-repeat" items="{{critical}}" as="soldier">
            <graph-personal soldier="{{soldier}}"></graph-personal>
          </template>
        <br>
          <template is="dom-repeat" items="{{hurt}}" as="soldier">
            <graph-personal soldier="{{soldier}}"></graph-personal>
          </template>
        <br>
          <template is="dom-repeat" items="{{unknown}}" as="soldier">
            <graph-personal soldier="{{soldier}}"></graph-personal>
          </template>
        <br>
          <template is="dom-repeat" items="{{normal}}" as="soldier">
            <graph-personal soldier="{{soldier}}"></graph-personal>
          </template>
    </paper-material>

  </template>
  <script>
    Polymer({
      is: 'graph-container',

      behaviors: [Polymer.NeonAnimationBehavior, Polymer.NeonAnimationRunnerBehavior],

      properties: {

        soldiers: {
          type: Object,
          notify: true
        },
        ordered: {
          type: Object,
          value: null,
          notify: true,
          computed: 'orderSoldiers(soldiers)'
        },
        critical: {
          type: Array,
          value: []
        },
        hurt: {
          type: Array,
          value: [],
          notify: true
        },
        normal: {
          type: Array,
          value: [],
          notify: true
        },
        unknown: {
          type: Array,
          value: [],
          notify: true
        },

        animationConfig: {
          value: function () {
            return {
              // fade-in-animation is run with a 50ms delay from slide-down-animation
              'entry': {
                name: 'slide-from-right-animation',
                node: this,
                timing: {"delay": 1500, "duration": 1000}
              }
            }
          }
        }
      },

      show: function () {
        this.style.visibility = 'visible';
        this.playAnimation('entry');
      },

      ready: function () {
        this.async(function () {
          this.show();
        })
      },


      time: function (mins) {
        return (moment().subtract(mins, 'm').format('x'));
      },

      orderSoldiers: function (soldiers) {
        var normal = [], hurt = [], critical = [], unknown = [];
        soldiers.forEach(function (soldier) {
          var info = {
            "id": soldier.id, "name": soldier.firstname + ' ' + soldier.lastname, "vi": soldier.vi,
            "activity": soldier.activity, "heartrate": soldier.heart_rate
          };
          switch (soldier.status) {
            case 0:
              normal.push(info);
              delete info.status;
              break;
            case 1:
              hurt.push(info);
              delete info.status;
              break;
            case 2:
              critical.push(info);
              delete info.status;
              break;
            case 3:
              unknown.push(info);
              delete info.status;
              break;
          }
        });
        var checkDiff = ((this.normal != normal) || (this.hurt != hurt) ||
        (this.critical != critical) || (this.unknown != unknown))
        this.normal = normal;
        this.hurt = hurt;
        this.critical = critical;
        this.unknown = unknown;
        return (checkDiff)
      }
    });
  </script>
</dom-module>
