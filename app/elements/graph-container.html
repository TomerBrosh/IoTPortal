<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="graph-container" attributes="soldiers selectedStatus">
  <template>
    <style>
      :host {
        display: inline-flex;
        visibility: hidden;
        width: 100%;
        margin-top: 5px;
      }

      paper-material {
        width: 100%;
        background-color: rgba(96, 125, 139, 0.2);
        text-align: center;
      }

      .graphs {
        @apply(--layout-horizontal);
      }


    </style>
    <paper-material elevation="3">

      <toggle-container>
        <h2>{{currentStatus.toString}}</h2>
        <div class="graphs">
          <template is="dom-repeat" items="{{currentStatus.array}}" as="soldier">
            <graph-personal soldier="{{soldier}}"></graph-personal>
          </template>
        </div>
        <hr>
      </toggle-container>
      <h2>מצב כללי</h2>
      <iframe
        src="http://iotservices.westeurope.cloudapp.azure.com:3000/dashboard-solo/db/soldier?editview=templating&panelId=2&fullscreen&from=1458412929222&to=1458413229222"
        width="100%" height="600" frameborder="0"></iframe>
    </paper-material>

  </template>
  <script>
    Polymer({
      is: 'graph-container',

      behaviors: [Polymer.NeonAnimationBehavior, Polymer.NeonAnimationRunnerBehavior],

      properties: {

        soldiers: {
          type: Object,
          notify: true
        },
        selected: {
          type: Number
        },
        currentStatus: {
          type: Array,
          computed: 'getCurrentStatus(selected)'
        },
        ordered: {
          type: Object,
          value: null,
          notify: true,
          computed: 'orderSoldiers(soldiers)'
        },
        critical: {
          type: Array,
          value: []
        },
        hurt: {
          type: Array,
          value: [],
          notify: true
        },
        normal: {
          type: Array,
          value: [],
          notify: true
        },
        unknown: {
          type: Array,
          value: [],
          notify: true
        },

        animationConfig: {
          value: function () {
            return {
              // fade-in-animation is run with a 50ms delay from slide-down-animation
              'entry': {
                name: 'slide-from-right-animation',
                node: this,
                timing: {"delay": 1500, "duration": 1000}
              }
            }
          }
        }
      },

//      listeners: {
//        'neon-animation-finish': '_onNeonAnimationFinish'
//      },

      show: function () {
        this.style.visibility = 'visible';
        this.playAnimation('entry');
      },

      ready: function () {
        this.async(function () {
          this.show();
        })
      },


      orderSoldiers: function (soldiers) {
        var normal = [], hurt = [], critical = [], unknown = [],
          all = {"normal": [], "hurt": [], "critical": [], "unknown": []};
        soldiers.forEach(function (soldier) {
          var basicInfo = {"id": soldier.id, "name": soldier.firstname + ' ' + soldier.lastname};
          var info = {
            "id": soldier.id, "name": soldier.firstname + ' ' + soldier.lastname, "vi": soldier.vi,
            "activity": soldier.activity, "heartrate": soldier.heart_rate
          };
          switch (soldier.status) {
            case 0:
              normal.push(info);
              delete info.status;
              all.normal.push(basicInfo);
              break;
            case 1:
              hurt.push(info);
              delete info.status;
              all.hurt.push(basicInfo);
              break;
            case 2:
              critical.push(info);
              delete info.status;
              all.critical.push(basicInfo);
              break;
            case 3:
              unknown.push(info);
              delete info.status;
              all.unknown.push(basicInfo);
              break;
          }
        });
        this.normal = normal;
        this.hurt = hurt;
        this.critical = critical;
        this.unknown = unknown;
        return all;
      },
      getCurrentStatus: function (status) {
        switch (status) {
          case 0:
            return {"array": this.normal, "toString": "חיילים במצב תקין:"};
            break;
          case 1:
            return {"array": this.hurt, "toString": "חיילים במצב בינוני:"};
            break;
          case 2:
            return {"array": this.critical, "toString": "חיילים במצב קשה:"};
            break;
          case 3:
            return {"array": this.unknown, "toString": "חיילים במצב לא ידוע:"};
            break;
        }
      }
    });
  </script>
</dom-module>
